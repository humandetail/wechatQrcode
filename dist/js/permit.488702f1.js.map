{"version":3,"sources":["webpack:///./src/views/Permit.vue?6d53","webpack:///src/views/Permit.vue","webpack:///./src/views/Permit.vue?bf74","webpack:///./src/views/Permit.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","permit","downloadDisabled","on","handleDownload","drawLoading","pictures","largePictures","txnId","$event","toggleChainInfo","_e","closeWechatDownloadTip","staticRenderFns","name","components","PageHeader","CommonFooter","LicenseInfo","Pictures","ChainInfo","FooterTips","BottomTip","WechatDownloadTip","data","port","certSeq","$route","params","id","showChainInfo","responseCode","qrBaseUrl","pdfDoc","showWechatDownloadTip","computed","pictureOptions","watermark","codeItem","qrcode","url","x","y","width","margin","scale","height","fields","pic","picCopy","methods","show","formatDate","newDate","split","created","getPermit","then","console","log","err","component"],"mappings":"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","file":"js/permit.488702f1.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page-permit\"},[_c('page-header'),_c('license-info',{attrs:{\"permit\":_vm.permit,\"downloadDisabled\":_vm.downloadDisabled},on:{\"download\":_vm.handleDownload}}),_c('pictures',{attrs:{\"loading\":_vm.drawLoading,\"pictures\":_vm.pictures,\"largePictures\":_vm.largePictures}}),(_vm.showChainInfo)?_c('chainInfo',{attrs:{\"txnId\":_vm.permit.txnId},on:{\"close\":function($event){return _vm.toggleChainInfo(false)}}}):_vm._e(),(_vm.showWechatDownloadTip)?_c('wechat-download-tip',{on:{\"close\":_vm.closeWechatDownloadTip}}):_vm._e(),_c('bottom-tip',{on:{\"showChainInfo\":function($event){return _vm.toggleChainInfo(true)}}}),_c('footer-tips'),_c('common-footer')],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"page-permit\">\n    <page-header />\n\n    <license-info\n      :permit=\"permit\"\n      :downloadDisabled=\"downloadDisabled\"\n      @download=\"handleDownload\"\n    />\n\n    <pictures\n      :loading=\"drawLoading\"\n      :pictures=\"pictures\"\n      :largePictures=\"largePictures\"\n    />\n\n    <chainInfo\n      v-if=\"showChainInfo\"\n      :txnId=\"permit.txnId\"\n      @close=\"toggleChainInfo(false)\"\n    />\n\n    <wechat-download-tip\n      v-if=\"showWechatDownloadTip\"\n      @close=\"closeWechatDownloadTip\"\n    />\n\n    <bottom-tip\n      @showChainInfo=\"toggleChainInfo(true)\"\n    /> \n\n    <footer-tips />\n\n    <common-footer />\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex';\nimport { getPermit } from 'models/Api';\nimport { jsPDF } from 'jspdf';\nimport { sleep } from 'utils/tools';\nimport PermitPicture from '@/plugins/PermitPicture';\nimport permitResponseCode from 'config/permitResponseCode';\n\n// import TestPic from '@/assets/imgs/permit/test.jpg';\n// import TestPicCopy from '@/assets/imgs/permit/test_copy.jpg';\n\nimport PageHeader from 'components/Sub/Header';\nimport LicenseInfo from 'components/Permit/LicenseInfo';\nimport Pictures from 'components/Permit/Pictures';\nimport ChainInfo from 'components/Permit/ChainInfo';\nimport FooterTips from 'components/Sub/Tips/Footer';\nimport BottomTip from 'components/Permit/BottomTip';\nimport CommonFooter from 'components/Sub/Footer';\nimport WechatDownloadTip from 'components/Permit/WechatDownloadTip';\n\nexport default {\n  name: 'Permit',\n  components: {\n    PageHeader,\n    CommonFooter,\n    LicenseInfo,\n    Pictures,\n    ChainInfo,\n    FooterTips, //  温馨提示\n    BottomTip, // permit页底部tip\n    WechatDownloadTip\n  },\n  data () {\n    let {\n      hostname,\n      protocol,\n      port,\n    } = window.location;\n\n    if (!port || port === 80 || port === 443) {\n      port = '';\n    } else {\n      port = ':' + port;\n    }\n\n    let qrBaseUrl = `${protocol}//${hostname}${port}/h5/qr/`;\n    return {\n      // permitNumber: this.$route.params.id || '',\n      certSeq: this.$route.params.id || '',\n      showChainInfo: false, // 是否显示区块链信息区域\n\n      pictures: [], // 72dpi下a4纸尺寸大小的图片数据\n      largePictures: [], // 大图数据\n\n      // {\n      //   \"picOneUrl\": string, // 照面1 底图\n      //   \"picTwoUrl\": string, // 照面2 底图\n      //   \"id\": number, // 自增id\n      //   \"oprName\": string, // 经营者名称，公司名称\n      //   \"uniformSocialCreditCode\": string, // 统一社会信用代码\n      //   \"permitLegalRepName\": string, // 法定代表人\n      //   \"permitResidence\": string, // 住所\n      //   \"permitBizPremises\": string, // 经营场所\n      //   \"permitMainFormat\": string, // 经营主体业态\n      //   \"permitOperatingItem\": string, // 经营项目\n      //   \"permitNumber\": string, // 许可证编号\n      //   \"permitSupervisionAgency\": string, // \b日常监督管理机构\n      //   \"permitSupervisionPerson\": string, // 日常监督管理人员\n      //   \"permitIssuingAgency\": string, // 发证机关\n      //   \"permitIssuingAgencyDid\": string, // 发证机构DID,\n      //   \"permitSigner\": string, // 签发人\n      //   \"permitIssuedTime\": string, // 颁发时间\n      //   \"permitEndDate\": string, // 有效结束时间\n      //   \"permitStatus\": \"1\", // 许可证状态（数据同步状态）\n      //   \"txnId\": string, // 上链交易id\n      //   \"txnStatus\": \"1\", // 上链状态\n      //   \"versionId\": 1, // 当前版本id\n      //   \"transferTime\": \"2020-08-31 16:33:52\",\n      //   \"spareFieldOne\": null,\n      //   \"spareFieldTwo\": null,\n      //   \"spareFieldThree\": null,\n      //   \"isDelete\": 0,\n      //   \"gmtCreate\": \"2020-08-31 16:35:27\",\n      //   \"gmtModified\": \"2020-08-31 16:37:52\"\n      // }\n      permit: {}, // 经营许可证详情\n      responseCode: 0, // 数据返回状态码，用于绘制证照过期等水印信息\n\n      qrBaseUrl: qrBaseUrl, // 移动端url地址\n\n      drawLoading: true,\n\n      pdfDoc: null, // PDF文档\n\n      downloadDisabled: true, // 是否禁用下载按钮\n\n      showWechatDownloadTip: false, // 是否显示微信浏览器下载遮罩提示\n    }\n  },\n  computed: {\n    ...mapGetters(['browserInfo']),\n    // 格式化图片信息\n    // Todo: 后期需要从后台获取图片配置信息\n    pictureOptions () {\n      const {\n        // picOneUrl: '',\n        // picTwoUrl: '',\n        oprName,\n        uniformSocialCreditCode,\n        permitLegalRepName,\n        permitResidence,\n        permitBizPremises,\n        permitMainFormat,\n        permitOperatingItem,\n        permitNumber,\n        permitSupervisionAgency,\n        permitSupervisionPerson,\n        permitIssuingAgency,\n        permitSigner,\n        permitIssuedTime,\n        permitEndDate,\n      } = this.permit;\n\n      const responseCode = this.responseCode,\n            codeItem = permitResponseCode.find((item) => item.code !== 0 && item.code === responseCode);\n\n      let watermark = ''; // 水印图片\n      try {\n        watermark = codeItem.watermark();\n      } catch {}\n\n      // 坐标信息\n      let leftX = 0.295, // left x 310 / 1080     28.7%\n          rightX = 0.704, // right x 760 / 1080   70.4%\n\n          y1 = 0.4237, // 1 300 / 764             39.27%\n          y2 = 0.4734, // 2 338 / 764             44.24%\n          y3 = 0.5332, // 3 386 / 764             50.52%\n          y4 = 0.5701, // 4 420 / 764             54.97%\n          y5 = 0.618, // 5 450 / 764              58.9%\n          y6 = 0.6671, // 6 486 / 764             63.61%\n          y7 = 0.7058, // 7 520 / 764             68.06%\n\n          leftMaxWidth = .2385, // 250,\n          rightMaxWidth = .222; // 240;\n\n      // 副本坐标信息\n      let copyLeftX = .257, // 270,\n          copyRightX = .6814, // 736,\n\n          copyY1 = .2617, // 190,\n          copyY2 = .315, // 230,\n          copyY3 = .3905, // 280,\n          copyY4 = .4388, // 320,\n          copyY5 = .4882, // 360,\n          copyY6 = .5838, // 430,\n          copyY7 = .6337, // 530,\n\n          copyYR1 = .4882,\n          copyYR2 = .525,\n          copyYR3 = .5628,\n          copyYR4 = .64,\n          copyYR5 = .715,\n\n          copyLeftMaxWidth = .259, // 280,\n          copyRightMaxWidth = .2407; // 260;\n\n      let pic = {\n        id: 'pic',\n        qrcode: {\n          url: `${this.qrBaseUrl}c?seq=${this.certSeq}`,\n          x: .543,\n          y: .76,\n          width: 100,\n          margin: 1,\n          scale: 4\n        },\n        watermark: !watermark ? null : {\n          url: watermark,\n          width: 200,\n          height: 200 * 678 / 909\n        },\n        fields: [\n          {\n            name: 'oprName',\n            value: oprName,\n            desc: '经营者名称，公司名称',\n            coordinate: [leftX, y1], // 坐标 百分比值\n            maxWidth: leftMaxWidth,\n          },\n          {\n            name: 'uniformSocialCreditCode',\n            value: uniformSocialCreditCode,\n            desc: '统一社会信用代码',\n            coordinate: [leftX, y2], // 坐标 百分比值\n            maxWidth: leftMaxWidth,\n          },\n          {\n            name: 'permitLegalRepName',\n            value: permitLegalRepName,\n            desc: '法定代表人',\n            coordinate: [leftX, y3], // 坐标 百分比值\n            maxWidth: leftMaxWidth,\n          },\n          {\n            name: 'permitResidence',\n            value: permitResidence,\n            desc: '住所',\n            coordinate: [leftX, y4], // 坐标 百分比值\n            maxWidth: leftMaxWidth,\n          },\n          {\n            name: 'permitBizPremises',\n            value: permitBizPremises,\n            desc: '经营场所',\n            coordinate: [leftX, y5], // 坐标 百分比值\n            maxWidth: leftMaxWidth,\n          },\n          {\n            name: 'permitMainFormat',\n            value: permitMainFormat,\n            desc: '经营主体业态',\n            coordinate: [leftX, y6], // 坐标 百分比值\n            maxWidth: leftMaxWidth,\n          },\n          {\n            name: 'permitOperatingItem',\n            value: permitOperatingItem,\n            desc: '经营项目',\n            coordinate: [leftX, y7], // 坐标 百分比值\n            maxWidth: leftMaxWidth,\n          },\n          {\n            name: 'permitNumber',\n            value: permitNumber,\n            desc: '许可证编号',\n            coordinate: [rightX, y1], // 坐标 百分比值\n            maxWidth: rightMaxWidth,\n          },\n          {\n            name: 'permitSupervisionAgency',\n            value: permitSupervisionAgency,\n            desc: '\b日常监督管理机构',\n            coordinate: [rightX, y2], // 坐标 百分比值\n            maxWidth: rightMaxWidth,\n          },\n          {\n            name: 'permitSupervisionPerson',\n            value: permitSupervisionPerson,\n            desc: '日常监督管理人员',\n            coordinate: [rightX, y3], // 坐标 百分比值\n            maxWidth: rightMaxWidth,\n          },\n          {\n            name: 'permitIssuingAgency',\n            value: permitIssuingAgency,\n            desc: '发证机关',\n            coordinate: [rightX, y5], // 坐标 百分比值\n            maxWidth: rightMaxWidth,\n          },\n          {\n            name: 'permitSigner',\n            value: permitSigner,\n            desc: '签发人',\n            coordinate: [rightX, y7], // 坐标 百分比值\n            maxWidth: rightMaxWidth,\n          },\n          {\n            name: 'permitIssuedTime',\n            value: this.formatDate(permitIssuedTime),\n            desc: '颁发时间',\n            coordinate: [\n              [0.6724, 0.7635], // 年\n              [0.75, 0.7635], // 月\n              [0.8, 0.7635], // 日\n            ], // 坐标 百分比值\n          },\n          {\n            name: 'permitEndDate',\n            value: this.formatDate(permitEndDate),\n            desc: '有效结束时间',\n            coordinate: [\n              [0.223, 0.8784], // 年\n              [0.3, 0.8784], // 月\n              [0.3475, 0.8784], // 日\n            ], // 坐标 百分比值\n          },\n        ]\n      }\n      \n      let picCopy = {\n        id: 'picCopy',\n        qrcode: {\n          url: `${this.qrBaseUrl}c?seq=${this.certSeq}`,\n          x: .543,\n          y: .76,\n          width: 100,\n          margin: 1,\n          scale: 4\n        },\n        watermark: !watermark ? null : {\n          url: watermark,\n          width: 200,\n          height: 200 * 678 / 909\n        },\n        fields: [\n          {\n            name: 'oprName',\n            value: oprName,\n            desc: '经营者名称，公司名称',\n            coordinate: [copyLeftX, copyY1], // 坐标 百分比值\n            maxWidth: copyLeftMaxWidth,\n          },\n          {\n            name: 'uniformSocialCreditCode',\n            value: uniformSocialCreditCode,\n            desc: '统一社会信用代码',\n            coordinate: [copyLeftX, copyY2], // 坐标 百分比值\n            maxWidth: copyLeftMaxWidth,\n          },\n          {\n            name: 'permitLegalRepName',\n            value: permitLegalRepName,\n            desc: '法定代表人',\n            coordinate: [copyLeftX, copyY3], // 坐标 百分比值\n            maxWidth: copyLeftMaxWidth,\n          },\n          {\n            name: 'permitResidence',\n            value: permitResidence,\n            desc: '住所',\n            coordinate: [copyLeftX, copyY4], // 坐标 百分比值\n            maxWidth: copyLeftMaxWidth,\n          },\n          {\n            name: 'permitBizPremises',\n            value: permitBizPremises,\n            desc: '经营场所',\n            coordinate: [copyLeftX, copyY5], // 坐标 百分比值\n            maxWidth: copyLeftMaxWidth,\n          },\n          {\n            name: 'permitMainFormat',\n            value: permitMainFormat,\n            desc: '经营主体业态',\n            coordinate: [copyLeftX, copyY6], // 坐标 百分比值\n            maxWidth: copyLeftMaxWidth,\n          },\n          {\n            name: 'permitOperatingItem',\n            value: permitOperatingItem,\n            desc: '经营项目',\n            coordinate: [copyLeftX, copyY7], // 坐标 百分比值\n            maxWidth: copyLeftMaxWidth,\n          },\n          {\n            name: 'permitNumber',\n            value: permitNumber,\n            desc: '许可证编号',\n            coordinate: [copyRightX, copyYR1], // 坐标 百分比值\n            maxWidth: copyRightMaxWidth\n          },\n          {\n            name: 'permitSupervisionAgency',\n            value: permitSupervisionAgency,\n            desc: '\b日常监督管理机构',\n            coordinate: [copyRightX, copyYR2], // 坐标 百分比值\n            maxWidth: copyRightMaxWidth\n          },\n          {\n            name: 'permitSupervisionPerson',\n            value: permitSupervisionPerson,\n            desc: '日常监督管理人员',\n            coordinate: [copyRightX, copyYR3], // 坐标 百分比值\n            maxWidth: copyRightMaxWidth\n          },\n          {\n            name: 'permitIssuingAgency',\n            value: permitIssuingAgency,\n            desc: '发证机关',\n            coordinate: [copyRightX, copyYR4], // 坐标 百分比值\n            maxWidth: copyRightMaxWidth\n          },\n          {\n            name: 'permitSigner',\n            value: permitSigner,\n            desc: '签发人',\n            coordinate: [copyRightX, copyYR5], // 坐标 百分比值\n            maxWidth: copyRightMaxWidth\n          },\n          {\n            name: 'permitIssuedTime',\n            value: this.formatDate(permitIssuedTime),\n            desc: '颁发时间',\n            coordinate: [\n              [0.6714, 0.7708], // 年\n              [0.737, 0.7708], // 月\n              [0.78, 0.7708], // 日\n            ], // 坐标 百分比值\n          },\n          {\n            name: 'permitEndDate',\n            value: this.formatDate(permitEndDate),\n            desc: '有效结束时间',\n            coordinate: [\n              [0.193, 0.8846], // 年\n              [0.26, 0.8846], // 月\n              [0.3, 0.8846], // 日\n            ], // 坐标 百分比值\n          },\n        ]\n      }\n\n      return [pic, picCopy];\n    }\n  },\n  methods: {\n    /**\n     * 获取许可证信息\n     */\n    async getPermit () {\n      const certSeq = this.certSeq;\n\n      if (this.permit && Object.keys(this.permit).length > 0) {\n        return;\n      }\n\n      const {\n        code,\n        message,\n        data\n      } = await getPermit(certSeq);\n\n      const codeItem = permitResponseCode.find((item => item.code === code));\n\n      if (codeItem) {\n        this.permit = data;\n        this.responseCode = code;\n\n        if (code !== 0) {\n          await this.$confirm(\n            codeItem.message,\n            codeItem.title,\n            {\n              confirmButtonText: '重新查询',\n              cancelButtonText: '继续查看',\n              showClose: false,\n              center: true,\n              closeOnClickModal: false, // 点击遮罩不允许关闭\n            }\n          ).then(() => {\n            window.location.href = window.location.origin + this.$router.options.base\n          }).catch((e) => {\n          })\n        }\n      } else {\n        return Promise.reject('No Data');\n      }\n    },\n\n    /**\n     * 生成照面信息\n     * @param isReview - 是否生成预览图\n     */\n    async createPictures (isReview = true) {\n      // 1 pt = px * dpi/72 = px * 4/3\n      const pictureOptions = this.pictureOptions,\n            len = pictureOptions.length,\n            permitPicture = new PermitPicture({\n              pageSize: isReview ? [1123, 794] : [3508, 2481], // 96dpi\n              // largePageSize: [3508, 2481], // 300dpi\n\n              fontSize: 18, // 18pt\n              fontColor: '#231F20',\n              fontFamily: 'permit-font,宋体,宋体-简,华文宋体',\n              fontMargin: 18,\n\n              specialFields: [\n                {\n                  name: 'permitResidence', // 住所\n                  maxRow: 2,\n                },\n                {\n                  name: 'permitBizPremises', // 经营场所\n                  maxRow: 2,\n                },\n                {\n                  name: 'permitOperatingItem', // 经营项目\n                  maxRow: 4\n                }\n              ]\n            });\n\n      let url,\n          fields,\n          watermark,\n          qrcode;\n\n      // 底图\n      const bottomPics = isReview\n        ? ['/permit/test1080.jpg', '/permit/test_copy1080.jpg']\n        : ['/permit/test.jpg', '/permit/test_copy.jpg'];\n\n      for (let i = 0; i < len; i ++) {\n        ({ fields, watermark, qrcode } = pictureOptions[i]);\n\n        url = bottomPics[i];\n\n        if (i === 1) {\n          permitPicture.setOptions({\n            fontSize: 16, // 默认16pt\n            specialFields: [\n              {\n                name: 'permitResidence', // 住所\n                maxRow: 2,\n              },\n              {\n                name: 'permitBizPremises', // 经营场所\n                maxRow: 4,\n              },\n              {\n                name: 'permitOperatingItem', // 经营项目\n                maxRow: 4\n              }\n            ]\n          })\n        }\n\n        // 绘制照面\n        await permitPicture.drawPicture({\n          bgImgUrl: url,\n          fields,\n          watermark,\n          qrcode\n        }, true);\n      }\n\n      // if (isReview) {\n      //   this.pictures = permitPicture.pictures;\n      //   // this.largePictures = await permitPicture.getPictures(3508, .9);\n      // }\n\n      let pictures;\n\n      if (isReview) {\n        pictures = permitPicture.pictures;\n      } else {\n        pictures = await permitPicture.getPictures(3508, .9);\n      }\n\n      this.drawLoading = false; // 关闭绘制loading\n\n      this.pictures = pictures;\n      this.largePictures = pictures;\n\n      return pictures;\n    },\n\n    // 切换区块链信息区域的显示、关闭\n    toggleChainInfo (show) {\n      this.showChainInfo = show;\n    },\n\n    /**\n     * 创建PDF文档\n     * @param { object } options - 配置项\n     * @param { number } options.width - 文档单页的宽度\n     * @param { number } options.height - 文档单页的高度\n     * @return { object } pdf文档对象\n     */\n    async createPDF ({ width = 841.89, height = 595.28 } = {}) {\n      // console.log(this.pictures)\n      if (this.pdfDoc) {\n        return this.pdfDoc;\n      }\n\n      const doc = new jsPDF('landscape', 'pt', 'a4'),\n            // pictures = this.pictures;\n            pictures = await this.createPictures(false),\n            len = pictures.length;\n\n      for (let i = 0; i < len; i ++) {\n        if (i > 0) {\n          await doc.addPage(); // 添加新的页面\n        }\n\n        // 添加图片\n        await doc.addImage(pictures[i], 'JPEG', 0, 0, width, height);\n      }\n\n      // pictures.forEach((picture, index) => {\n      //   if (index > 0) {\n      //     doc.addPage(); // 添加新的页面\n      //   }\n\n      //   alert(index)\n\n      //   // 添加图片\n      //   doc.addImage(picture, 'JPEG', 0, 0, width, height);\n      // });\n\n      this.pdfDoc = doc;\n\n      return doc;\n    },\n\n    /**\n     * 下载PDF\n     * @param { string } filename - 保存的文件名称\n     */\n    async handleDownload (filename = '') {\n      const { browser = '' } = this.browserInfo;\n\n      // 当前浏览器环境为微信浏览器时\n      // 显示提示遮罩\n      if (browser.toUpperCase() === 'WECHAT') {\n        this.showWechatDownloadTip = true;\n        return;\n      }\n\n      // 开启全屏加载\n      const loading = this.$loading({\n          lock: true,\n          text: 'Loading',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n      });\n\n      const doc = await this.createPDF();\n\n      // await sleep(300);\n\n      loading.close();\n\n      doc.save(\n        filename\n          ? filename + '.pdf'\n          : this.permit.permitType + '-' + this.permit.oprName + '.pdf'\n      );\n    },\n\n    // /**\n    //  * 下载\n    //  */\n    // handleDownload () {\n    //   let url = 'http://192.168.3.47:8080/h5/favicon.ico',\n    //       oAnchor = document.createElement('a');\n\n    //   oAnchor.download = 'testdownload.jpeg';\n    //   oAnchor.href = url;\n    //   oAnchor.target ='_blank';\n\n    //   document.body.appendChild(oAnchor);\n    //   oAnchor.click();\n    //   document.body.removeChild(oAnchor);\n    // },\n\n    // 关闭微信下载提示遮罩\n    closeWechatDownloadTip () {\n      this.showWechatDownloadTip = false;\n    },\n\n    /**\n     * 格式日期\n     * @param { string } date - YYYY-MM-DD hh:mm:ss 格式日期\n     * @return { array } 返回 [YYYY, MM, DD] 格式数组\n     */\n    formatDate (date = '') {\n      const [newDate = ''] = date.split(' ');\n\n      return newDate.split('-');\n    }\n  },\n  created () {\n    this.getPermit().then(async () => {\n      await this.createPictures();\n      await this.$nextTick();\n      this.downloadDisabled = false;\n    }).catch((err) => {\n      console.log(err);\n      this.$router.push('/404');\n    });\n  }\n}\n</script>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Permit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Permit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Permit.vue?vue&type=template&id=0af85806&\"\nimport script from \"./Permit.vue?vue&type=script&lang=js&\"\nexport * from \"./Permit.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}